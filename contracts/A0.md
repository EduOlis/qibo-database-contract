# EntregÃ¡vel B â€” Contrato Formal do Agente A0
## Agente de ExtraÃ§Ã£o de EvidÃªncias ClÃ­nicas

## 1. DefiniÃ§Ã£o Exata do Agente A0

### Identidade

**Nome:** Agente A0 â€” ExtraÃ§Ã£o de EvidÃªncias

**Natureza:** IA assistiva, nÃ£o-autÃ´noma

**Responsabilidade Ãºnica:** Identificar e sugerir trechos de texto literais potencialmente relevantes para conhecimento clÃ­nico, sem interpretar, validar ou estruturar conhecimento.

âš ï¸ **O A0 nÃ£o cria conhecimento. Ele apenas aponta onde pode existir conhecimento.**

## 2. PosiÃ§Ã£o no Pipeline

```
P0 (determinÃ­stico)
  â†“
kb_raw_chunks
  â†“
A0 (IA assistiva)
  â†“
kb_evidence_excerpts
  â†“
Gate humano obrigatÃ³rio
```

**O A0 nunca escreve diretamente em:**
- `kb_entity_proposals`
- `tcm_*` (qualquer tabela final de conhecimento clÃ­nico)

## 2.1 Perfil de ExecuÃ§Ã£o

Toda execuÃ§Ã£o do agente A0 DEVE ocorrer sob um perfil de execuÃ§Ã£o explicitamente registrado (profile_id).

O profile_id identifica um conjunto imutÃ¡vel de ferramentas, versÃµes e limites operacionais sob os quais o A0 foi executado.

O A0 NÃƒO pode ser executado sem:

- profile_id vÃ¡lido
- registro de execuÃ§Ã£o correspondente em tabela de auditoria

A ausÃªncia de profile_id invalida a execuÃ§Ã£o.

## 3. Input (Entrada)

**Tabela lida:** `kb_raw_chunks`

**Campos utilizados:**
- `id` (uuid)
- `source_id` (uuid)
- `raw_text` (text)
- `language` (text)
- `page_reference` (text)
- `processed` (boolean)

**PrÃ©-condiÃ§Ãµes:**
- `processed = false` (indica que o chunk ainda nÃ£o foi submetido ao A0)
- `raw_text` nÃ£o vazio
- `source_id` vÃ¡lido

**Regras sobre o campo `processed`:**
- `processed = false` indica que o chunk ainda nÃ£o foi submetido ao A0
- `processed = true` indica que o chunk jÃ¡ foi analisado pelo A0 sob algum profile_id

A reexecuÃ§Ã£o do A0 sobre chunks com `processed = true` sÃ³ Ã© permitida se:
- um novo profile_id for utilizado, ou
- houver registro explÃ­cito de reexecuÃ§Ã£o nos logs de auditoria

## 4. Output (SaÃ­da)

**Tabela escrita:** `kb_evidence_excerpts`

**Campos preenchidos pelo A0:**

- **`id`** (uuid, gerado)

- **`chunk_id`** (uuid â†’ `kb_raw_chunks.id`)

- **`excerpt_text`** (text) ğŸ”’ Texto copiado literalmente

- **`suggested_entity_type`** (text livre, nÃ£o enum):
  - `"symptom"`
  - `"clinical_sign"`
  - `"syndrome"`
  - `"acupoint"`
  - `"therapeutic_principle"`
  - `"mixed"`
  - `"uncertain"`

- **`relevance_score`** (numeric, 0.00 â€“ 1.00)

- **`justification`** (text)
  â†’ explicaÃ§Ã£o do porquÃª o trecho pode ser relevante, sem interpretaÃ§Ã£o clÃ­nica

- **`language`** (text)

- **`page_reference`** (text)

- **`status`** (text, default: `"pending"`)

- **`created_at`** (timestamp)

âš ï¸ **O A0 nÃ£o define `reviewed_by`, `reviewed_at`, `review_notes`.**

## 5. Regras Estritas de Processamento

### 5.1 PreservaÃ§Ã£o do Texto

- `excerpt_text` **DEVE** ser um substring literal de `kb_raw_chunks.raw_text`
- Nenhuma palavra pode ser:
  - alterada
  - resumida
  - completada
  - inferida
  - normalizada
- Se o trecho nÃ£o existir literalmente no chunk â†’ **violaÃ§Ã£o grave de contrato**

### 5.2 Escopo da IA

**O A0 PODE:**
- Identificar padrÃµes linguÃ­sticos associados a conceitos clÃ­nicos
- Sugerir um tipo genÃ©rico (`suggested_entity_type`)
- Estimar relevÃ¢ncia relativa do trecho

**O A0 NÃƒO PODE:**
- Criar definiÃ§Ãµes clÃ­nicas
- Inferir relaÃ§Ãµes entre entidades
- Criar cÃ³digos, nomes normalizados ou estruturas
- Decidir validade cientÃ­fica ou clÃ­nica

## 6. Status e Workflow

**Campo `status`:**
- `"pending"` â†’ padrÃ£o inicial
- `"approved"` â†’ apenas humano
- `"rejected"` â†’ apenas humano

âš ï¸ **O A0 nunca altera o status apÃ³s a criaÃ§Ã£o.**

## 7. Logs e Auditoria

**Tabela sugerida:** `kb_ingestion_logs` ou `mcp_audit_logs`

**Campos mÃ­nimos:**
- `operation = "A0_extraction"`
- `agent_name = "A0"`
- `agent_version`
- `input_chunks_count`
- `output_excerpts_count`
- `warnings`
- `execution_time_ms`

**Regra contratual:**

Toda execuÃ§Ã£o do A0 DEVE gerar exatamente um registro de auditoria.

ExecuÃ§Ãµes sem log sÃ£o consideradas invÃ¡lidas, mesmo que tenham produzido output.

## 8. Invariantes do Sistema

### Invariantes de Integridade

- Todo `kb_evidence_excerpts.chunk_id` deve existir
- Um chunk pode gerar 0..N excerpts
- Um excerpt pertence a exatamente 1 chunk

### Invariantes de SeguranÃ§a

- Nenhum dado clÃ­nico validado Ã© criado
- Nenhuma entidade final Ã© inferida
- Nenhuma relaÃ§Ã£o Ã© persistida

## 9. IdempotÃªncia e ReexecuÃ§Ã£o

- O A0 pode ser reexecutado
- DuplicaÃ§Ã£o nÃ£o Ã© desejÃ¡vel, mas pode ocorrer se explicitamente permitida
- Idealmente:
  - chunks processados recebem `processed = true`, ou
  - controle via `kb_ingestion_logs`

## 10. O Que Explicitamente NÃƒO Ã‰ Responsabilidade do A0

âŒ Criar entidades clÃ­nicas
âŒ Criar propostas estruturadas
âŒ Aprovar ou rejeitar conteÃºdo
âŒ Criar relaÃ§Ãµes entre sintomas, sÃ­ndromes e pontos
âŒ Migrar dados
âŒ Validar cientificamente qualquer trecho

### 10.1 RestriÃ§Ã£o Absoluta: kb_entity_proposals

**O A0 NUNCA:**
- Insere registros em `kb_entity_proposals`
- Atualiza registros em `kb_entity_proposals`
- Altera status de propostas
- Aprova ou rejeita propostas

A criaÃ§Ã£o de propostas estruturadas Ã© responsabilidade exclusiva de:
- Agentes superiores (A1, A2, etc.)
- Revisores humanos qualificados

**Regra de schema obrigatÃ³ria:**
- Todo registro em `kb_entity_proposals` DEVE conter `entity_label` (NOT NULL)
- `entity_label` deve ser:
  - ExtraÃ­do literalmente do texto fonte, ou
  - Um rÃ³tulo mÃ­nimo e neutro, sem inferÃªncia clÃ­nica
- NormalizaÃ§Ã£o, traduÃ§Ã£o ou inferÃªncia semÃ¢ntica sÃ£o proibidas.

## 11. Limite Intencional do A0

O agente A0 possui limites intencionais e intransponÃ­veis, definidos para garantir integridade epistemolÃ³gica da base de conhecimento.

1. O A0 NÃƒO realiza validaÃ§Ã£o cientÃ­fica, clÃ­nica, terapÃªutica ou epistemolÃ³gica
2. O A0 NÃƒO julga correÃ§Ã£o, plausibilidade ou aderÃªncia a padrÃµes clÃ­nicos
3. O A0 NÃƒO rejeita ou rebaixa trechos por critÃ©rios de veracidade
4. O A0 NÃƒO adiciona observaÃ§Ãµes crÃ­ticas ou qualificaÃ§Ãµes
5. O papel do A0 Ã© estritamente mecÃ¢nico e textual:
   identificar, recortar e registrar trechos literais da fonte original.
6. Qualquer validaÃ§Ã£o, interpretaÃ§Ã£o ou curadoria Ã© responsabilidade exclusiva de humanos ou agentes posteriores.

**Este limite Ã© deliberado.**
**Qualquer expansÃ£o deste escopo constitui violaÃ§Ã£o de contrato.**

## 12. Exemplo Simplificado

**Input** (`kb_raw_chunks.raw_text`):
```
"A sÃ­ndrome de DeficiÃªncia de Yin do Rim manifesta-se com sudorese noturna e boca seca."
```

**Output** (`kb_evidence_excerpts`):
```json
{
  "excerpt_text": "A sÃ­ndrome de DeficiÃªncia de Yin do Rim manifesta-se com sudorese noturna e boca seca.",
  "suggested_entity_type": "syndrome",
  "relevance_score": 0.91,
  "justification": "O trecho contÃ©m descriÃ§Ã£o explÃ­cita de uma sÃ­ndrome e sinais associados.",
  "status": "pending"
}
```

## 13. Ponto de AtenÃ§Ã£o CrÃ­tico

Se o A0 produzir texto como:

> "Este texto descreve vÃ¡rias sÃ­ndromesâ€¦"

ğŸ‘‰ **Contrato violado.**
**Isso Ã© resumo, nÃ£o evidÃªncia.**
