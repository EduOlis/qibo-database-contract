# EntregÃ¡vel B â€” Contrato Formal do Agente A0
## Agente de ExtraÃ§Ã£o de EvidÃªncias ClÃ­nicas

## 1. DefiniÃ§Ã£o Exata do Agente A0

### Identidade

**Nome:** Agente A0 â€” ExtraÃ§Ã£o de EvidÃªncias

**Natureza:** IA assistiva, nÃ£o-autÃ´noma

**Responsabilidade Ãºnica:**
Identificar e sugerir trechos de texto brutos potencialmente relevantes para conhecimento clÃ­nico, sem interpretar ou estruturar entidades finais.

âš ï¸ **A0 nÃ£o cria conhecimento, apenas aponta onde pode existir conhecimento.**

## 2. PosiÃ§Ã£o no Pipeline

```
P0 (determinÃ­stico)
 â†“
kb_raw_chunks
 â†“
A0 (IA assistiva)
 â†“
kb_evidence_excerpts
 â†“
Gate humano obrigatÃ³rio
```

**A0 nunca escreve diretamente em:**
- `kb_entity_proposals` â€” A0 nÃ£o cria, nÃ£o altera, nÃ£o aprova propostas de entidades
- `tcm_*` â€” Nenhuma tabela final de conhecimento clÃ­nico

## 3. Input (Entrada)

**Tabela lida:** `kb_raw_chunks`

**Campos utilizados:**
- `id` (uuid)
- `source_id` (uuid)
- `raw_text` (text)
- `language` (text)
- `page_reference` (text)
- `processed` (boolean)

**PrÃ©-condiÃ§Ãµes:**
- `processed = false`
- `raw_text` nÃ£o vazio
- `source_id` vÃ¡lido

## 4. Output (SaÃ­da)

**Tabela escrita:** `kb_evidence_excerpts`

**Campos preenchidos pelo A0:**

- **`id`** (uuid, gerado)

- **`chunk_id`** (uuid â†’ `kb_raw_chunks.id`)

- **`raw_text`** (text)
  ğŸ”’ Texto copiado literalmente, sem:
  - resumo
  - reescrita
  - limpeza semÃ¢ntica

- **`suggested_type`** (text)
  Valores possÃ­veis (string livre, nÃ£o enum):
  - `"symptom"`
  - `"clinical_sign"`
  - `"syndrome"`
  - `"acupoint"`
  - `"therapeutic_principle"`
  - `"mixed"`
  - `"uncertain"`

- **`relevance_score`** (numeric 0.00â€“1.00)

- **`justification`** (text)
  â†’ explicaÃ§Ã£o do porquÃª o trecho pode ser relevante, **nÃ£o** interpretaÃ§Ã£o clÃ­nica

- **`language`** (text)

- **`page_reference`** (text)

- **`status`** (text, default: `"pending"`)

- **`created_at`** (timestamp)

- **`created_by_agent`** (text, ex: `"A0-evidence-extractor"`)

## 5. Regras Estritas de Processamento

### 5.1 PreservaÃ§Ã£o do Texto

- `raw_text` **DEVE** ser um substring literal de `kb_raw_chunks.raw_text`
- Nenhuma palavra pode ser:
  - alterada
  - resumida
  - completada
  - inferida
- Se o trecho nÃ£o existir literalmente no chunk â†’ **erro grave de contrato**

### 5.2 Escopo da IA

**O A0 PODE:**
- Identificar padrÃµes linguÃ­sticos
- Reconhecer possÃ­veis conceitos clÃ­nicos
- Sugerir tipo genÃ©rico (`suggested_type`)
- Estimar relevÃ¢ncia relativa

**O A0 NÃƒO PODE:**
- Criar definiÃ§Ãµes clÃ­nicas
- Inferir relaÃ§Ãµes entre entidades
- Criar cÃ³digos, nomes normalizados ou estruturas
- Decidir validade clÃ­nica

## 6. Status e Workflow

**Campo `status`:**
- `"pending"` â†’ padrÃ£o inicial
- `"approved"` â†’ apenas humano
- `"rejected"` â†’ apenas humano

âš ï¸ **A0 nunca altera `status` apÃ³s criaÃ§Ã£o**

## 7. Logs e Auditoria

**Tabela:** `kb_ingestion_logs` ou `mcp_audit_logs`

**Campos mÃ­nimos:**
- `operation = "A0_extraction"`
- `agent_name = "A0"`
- `agent_version`
- `input_chunks_count`
- `output_excerpts_count`
- `warnings`
- `execution_time_ms`

## 8. Invariantes do Sistema

### Invariantes de Integridade

- Todo `kb_evidence_excerpts.chunk_id` deve existir
- Um chunk pode gerar 0..N excerpts
- Um excerpt pertence a exatamente 1 chunk

### Invariantes de SeguranÃ§a

- Nenhum dado clÃ­nico validado Ã© criado
- Nenhuma entidade final Ã© inferida
- Nenhuma relaÃ§Ã£o Ã© persistida

## 9. IdempotÃªncia e ReexecuÃ§Ã£o

- A0 pode ser reexecutado
- DuplicaÃ§Ã£o Ã© permitida somente se explicitamente solicitada
- Idealmente:
  - chunks jÃ¡ processados recebem `processed = true`
  - ou controle por `kb_ingestion_logs`

## 10. O Que Explicitamente NÃƒO Ã‰ Responsabilidade do A0

âŒ Criar entidades clÃ­nicas
âŒ Criar propostas estruturadas (incluindo `kb_entity_proposals`)
âŒ Aprovar ou rejeitar conteÃºdo
âŒ Criar relaÃ§Ãµes entre sintomas, sÃ­ndromes e pontos
âŒ Migrar dados
âŒ Validar cientificamente qualquer trecho

### 10.1 RestriÃ§Ã£o Absoluta: kb_entity_proposals

**O A0 NUNCA:**
- Insere registros em `kb_entity_proposals`
- Atualiza registros em `kb_entity_proposals`
- Altera status de propostas
- Aprova ou rejeita propostas

A criaÃ§Ã£o de propostas estruturadas Ã© responsabilidade exclusiva de:
- Agentes superiores no pipeline (A1, A2, etc.)
- Revisores humanos qualificados
- Ferramentas de migraÃ§Ã£o supervisionadas

**Regra de schema obrigatÃ³ria:**
- Todo registro em `kb_entity_proposals` DEVE conter `entity_label` (NOT NULL)
- `entity_label` deve ser um nome literal ou rÃ³tulo mÃ­nimo neutro
- NormalizaÃ§Ã£o, traduÃ§Ã£o ou inferÃªncia semÃ¢ntica sÃ£o proibidas

### 10.2 Regras para kb_entity_proposals (aplicÃ¡veis a agentes superiores)

As seguintes regras aplicam-se a agentes que PODEM criar propostas (A1, A2, etc.), mas NÃƒO ao A0:

**entity_type Ã© obrigatÃ³rio**
- Indica o tipo da entidade clÃ­nica proposta (symptom, syndrome, acupoint, clinical_sign, etc.)

**entity_label Ã© obrigatÃ³rio**
- DEVE ser um nome literal extraÃ­do do texto original, ou
- Um rÃ³tulo mÃ­nimo e neutro, sem inferÃªncia clÃ­nica

**ProibiÃ§Ãµes:**
- Normalizar nomes
- Traduzir termos
- Expandir siglas
- Inferir sinonÃ­mias
- Criar definiÃ§Ãµes conceituais

**proposed_data Ã© opcional e restrito**
- Metadados estruturais apenas
- ReferÃªncias ao trecho literal
- InformaÃ§Ãµes explicitamente declaradas no texto fonte
- PROIBIDO: definiÃ§Ãµes clÃ­nicas, relaÃ§Ãµes causais, interpretaÃ§Ãµes diagnÃ³sticas

**SeparaÃ§Ã£o de responsabilidades:**
- Criador da proposta: agente superior ou humano
- AlteraÃ§Ã£o de status: APENAS revisor humano qualificado
- Campos restritos: `status`, `reviewed_by`, `reviewed_at`, `review_notes`

## 11. Exemplo Simplificado

**Input** (`kb_raw_chunks.raw_text`):
```
"A sÃ­ndrome de DeficiÃªncia de Yin do Rim manifesta-se com sudorese noturna e boca seca."
```

**Output** (`kb_evidence_excerpts`):
```json
{
  "raw_text": "A sÃ­ndrome de DeficiÃªncia de Yin do Rim manifesta-se com sudorese noturna e boca seca.",
  "suggested_type": "syndrome",
  "relevance_score": 0.91,
  "justification": "O trecho descreve explicitamente uma sÃ­ndrome e seus sinais clÃ­nicos associados.",
  "status": "pending"
}
```

## 12. Ponto de AtenÃ§Ã£o (importante)

Se o A0 comeÃ§ar a produzir texto como:

> "Este texto descreve vÃ¡rias sÃ­ndromesâ€¦"

ğŸ‘‰ **Contrato violado.**
Isso Ã© resumo, nÃ£o evidÃªncia.
