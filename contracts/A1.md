# Contrato Formal do Agente A1
## Agente de Agrupamento Conservador de EvidÃªncias

## 1. DefiniÃ§Ã£o Exata do Agente A1

### Identidade

**Nome:** Agente A1 â€” Agrupamento Conservador de EvidÃªncias

**Modelo de OperaÃ§Ã£o:** A1-Î± (conservador)

**Natureza:** IA assistiva, nÃ£o-autÃ´noma, estritamente dependente de aprovaÃ§Ã£o humana prÃ©via

**Responsabilidade Ãºnica:** Agrupar evidÃªncias textuais previamente aprovadas por humanos, propor rÃ³tulos provisÃ³rios neutros e sinalizar possÃ­veis conflitos ou redundÃ¢ncias, sem realizar inferÃªncia clÃ­nica, normalizaÃ§Ã£o ou criaÃ§Ã£o de conhecimento.

âš ï¸ **O A1 nÃ£o cria conhecimento clÃ­nico. Ele apenas organiza evidÃªncias aprovadas para etapas posteriores.**

## 2. DependÃªncia ObrigatÃ³ria

O agente A1 depende integralmente do contrato A0 e de seus invariants de execuÃ§Ã£o congelados.

**ReferÃªncias obrigatÃ³rias:**
- `contracts/A0.md` (hash: `ab43bca68c1607c3b140bb72a60497d068a8ccd41145f29b00eedcbfbeab852c`)
- `contracts/a0_execution_invariants_v1.md` (hash: `dd34f985ae3ca215378af9550d702a18fbe846c4d2b1186455e8a824577480da`)

**Regras de dependÃªncia:**
- O A1 NÃƒO redefine responsabilidades do A0
- O A1 NÃƒO estende o escopo do A0
- O A1 NÃƒO reinterpreta decisÃµes do A0
- Qualquer mudanÃ§a futura em A0 invalida semanticamente este contrato

## 3. PosiÃ§Ã£o no Pipeline

```
P0 (determinÃ­stico)
  â†“
kb_raw_chunks
  â†“
A0 (extraÃ§Ã£o)
  â†“
kb_evidence_excerpts [status=pending]
  â†“
Gate humano obrigatÃ³rio (aprovaÃ§Ã£o)
  â†“
kb_evidence_excerpts [status=approved]
  â†“
A1 (agrupamento conservador)
  â†“
Estruturas intermediÃ¡rias nÃ£o finais
```

**O A1 nunca escreve diretamente em:**
- `tcm_*` (qualquer tabela final de conhecimento clÃ­nico)
- Tabelas de entidades clÃ­nicas finalizadas
- Tabelas de relaÃ§Ãµes causais, terapÃªuticas ou diagnÃ³sticas

## 4. Input (Entrada)

**Tabela lida:** `kb_evidence_excerpts`

**CondiÃ§Ãµes obrigatÃ³rias simultÃ¢neas:**

Todos os registros lidos pelo A1 DEVEM atender cumulativamente a:

1. `status = "approved"`
2. `reviewed_by IS NOT NULL` (aprovaÃ§Ã£o humana registrada)
3. `reviewed_at IS NOT NULL` (timestamp de aprovaÃ§Ã£o registrada)

**Campos utilizados:**
- `id` (uuid)
- `chunk_id` (uuid)
- `excerpt_text` (text)
- `suggested_entity_type` (text)
- `relevance_score` (numeric)
- `justification` (text)
- `language` (text)
- `status` (text)
- `reviewed_by` (uuid)
- `reviewed_at` (timestamp)

**RestriÃ§Ãµes absolutas de entrada:**

O A1 explicitamente NÃƒO pode:
- Ler registros com `status = "pending"`
- Ler registros com `status = "rejected"`
- Inferir ou completar dados ausentes
- Acessar diretamente `kb_raw_chunks` para reprocessamento
- Reinterpretar decisÃµes de aprovaÃ§Ã£o/rejeiÃ§Ã£o do A0 ou de humanos

## 5. Output (SaÃ­da)

**Natureza da saÃ­da:** Estruturas intermediÃ¡rias nÃ£o finais e nÃ£o clÃ­nicas

**Tabelas de trabalho sugeridas:**
- `kb_evidence_clusters` (agrupamentos provisÃ³rios)
- `kb_provisional_labels` (rÃ³tulos neutros temporÃ¡rios)
- `kb_evidence_conflicts` (sinalizaÃ§Ãµes de conflitos/redundÃ¢ncias)

**Campos tÃ­picos de saÃ­da:**

### 5.1 Agrupamentos (`kb_evidence_clusters`)
- `cluster_id` (uuid, gerado)
- `evidence_ids` (array de uuid â†’ `kb_evidence_excerpts.id`)
- `cluster_basis` (text: descriÃ§Ã£o textual da base do agrupamento)
- `provisional_label` (text: rÃ³tulo neutro e nÃ£o normalizado)
- `confidence_level` (numeric, 0.00 â€“ 1.00)
- `created_at` (timestamp)

### 5.2 RÃ³tulos ProvisÃ³rios (`kb_provisional_labels`)
- `label_id` (uuid, gerado)
- `label_text` (text: rÃ³tulo extraÃ­do ou mÃ­nimo)
- `evidence_ids` (array de uuid)
- `label_type` (text: descritivo, nÃ£o ontolÃ³gico)
- `created_at` (timestamp)

### 5.3 SinalizaÃ§Ãµes (`kb_evidence_conflicts`)
- `conflict_id` (uuid, gerado)
- `evidence_id_a` (uuid)
- `evidence_id_b` (uuid)
- `conflict_type` (text: "redundancy", "contradiction", "overlap")
- `description` (text)
- `created_at` (timestamp)

âš ï¸ **Todas as saÃ­das do A1 sÃ£o provisÃ³rias e requerem validaÃ§Ã£o humana subsequente.**

## 6. Escopo Permitido

O agente A1 PODE realizar exclusivamente as seguintes operaÃ§Ãµes:

### 6.1 Agrupamento por Similaridade
- Agrupar evidÃªncias aprovadas por similaridade textual superficial
- Agrupar evidÃªncias aprovadas por similaridade semÃ¢ntica baseada em embeddings
- Identificar co-ocorrÃªncias textuais entre evidÃªncias

**RestriÃ§Ã£o:** Agrupamentos devem ser baseados exclusivamente em caracterÃ­sticas textuais observÃ¡veis, nÃ£o em inferÃªncias clÃ­nicas.

### 6.2 ProposiÃ§Ã£o de RÃ³tulos Neutros
- Extrair rÃ³tulos diretamente do texto das evidÃªncias aprovadas
- Propor rÃ³tulos mÃ­nimos e descritivos quando extraÃ§Ã£o literal nÃ£o for possÃ­vel
- Manter registro da fonte textual de cada rÃ³tulo proposto

**RestriÃ§Ã£o:** RÃ³tulos devem ser neutros, provisÃ³rios e nÃ£o normalizados. Nenhuma traduÃ§Ã£o, normalizaÃ§Ã£o ontolÃ³gica ou enriquecimento semÃ¢ntico Ã© permitido.

### 6.3 SinalizaÃ§Ã£o de Conflitos e RedundÃ¢ncias
- Identificar evidÃªncias aprovadas que parecem descrever o mesmo conceito (redundÃ¢ncia)
- Identificar evidÃªncias aprovadas que parecem contradizer-se (conflito)
- Identificar sobreposiÃ§Ãµes textuais significativas entre evidÃªncias

**RestriÃ§Ã£o:** SinalizaÃ§Ãµes devem ser descritivas e factuais, nunca resolutivas. O A1 nÃ£o resolve conflitos, apenas os sinaliza.

### 6.4 ProduÃ§Ã£o de Estruturas IntermediÃ¡rias
- Criar agrupamentos temporÃ¡rios de evidÃªncias
- Gerar Ã­ndices e metadados auxiliares
- Preparar dados para revisÃ£o humana ou processamento por agentes superiores (A2, A3, etc.)

**RestriÃ§Ã£o:** Estruturas intermediÃ¡rias nÃ£o sÃ£o conhecimento clÃ­nico final e devem ser claramente marcadas como provisÃ³rias.

## 7. Escopo Proibido

O agente A1 explicitamente NÃƒO pode realizar as seguintes operaÃ§Ãµes:

### 7.1 CriaÃ§Ã£o de Entidades ClÃ­nicas Finais
âŒ Criar registros em tabelas de entidades clÃ­nicas finalizadas
âŒ Definir entidades como "vÃ¡lidas" ou "canÃ´nicas"
âŒ Atribuir cÃ³digos de ontologias clÃ­nicas (ICD, SNOMED, etc.)

### 7.2 InferÃªncia de RelaÃ§Ãµes
âŒ Inferir relaÃ§Ãµes causais entre sintomas e sÃ­ndromes
âŒ Inferir relaÃ§Ãµes terapÃªuticas entre pontos e condiÃ§Ãµes
âŒ Inferir relaÃ§Ãµes diagnÃ³sticas entre sinais e doenÃ§as
âŒ Criar grafos de conhecimento clÃ­nico

### 7.3 NormalizaÃ§Ã£o e Enriquecimento
âŒ Normalizar terminologia clÃ­nica
âŒ Traduzir conceitos entre idiomas ou sistemas
âŒ Aplicar ontologias ou vocabulÃ¡rios controlados
âŒ Enriquecer evidÃªncias com conhecimento externo

### 7.4 SubstituiÃ§Ã£o de Julgamento Humano
âŒ Aprovar ou rejeitar evidÃªncias
âŒ Alterar o campo `status` de qualquer evidÃªncia
âŒ Sobrescrever decisÃµes de revisÃ£o humana
âŒ Validar cientificamente qualquer conteÃºdo

### 7.5 Acesso a Dados NÃ£o Aprovados
âŒ Processar evidÃªncias com `status = "pending"`
âŒ Processar evidÃªncias com `status = "rejected"`
âŒ Reprocessar chunks originais de `kb_raw_chunks`
âŒ Inferir dados ausentes ou incompletos

## 8. Modelo de Falha AceitÃ¡vel

O agente A1 adota o princÃ­pio de conservadorismo epistÃªmico:

### 8.1 PrincÃ­pios de Falha
- **Falsos negativos sÃ£o aceitÃ¡veis:** Ã‰ preferÃ­vel omitir um agrupamento do que criar um agrupamento incorreto
- **OmissÃ£o Ã© preferÃ­vel Ã  inferÃªncia:** Na ausÃªncia de evidÃªncia explÃ­cita, o A1 deve abster-se de produzir saÃ­da
- **Incerteza deve ser explicitada:** Quando a confianÃ§a Ã© baixa, o A1 deve sinalizar incerteza, nÃ£o forÃ§ar conclusÃµes

### 8.2 Thresholds de ConfianÃ§a
- Agrupamentos com `confidence_level < 0.60` devem ser sinalizados como "baixa confianÃ§a"
- RÃ³tulos provisÃ³rios derivados de evidÃªncia Ãºnica devem ser marcados como "fonte Ãºnica"
- Conflitos identificados com baixa certeza devem incluir nota "possÃ­vel conflito, requer revisÃ£o"

### 8.3 Regra de AbstenÃ§Ã£o
Em caso de dÃºvida sobre:
- A similaridade entre evidÃªncias
- A adequaÃ§Ã£o de um rÃ³tulo
- A natureza de um conflito

O A1 DEVE abster-se de produzir saÃ­da ou produzir saÃ­da marcada como "incerta, requer revisÃ£o humana".

## 9. Regras Estritas de Processamento

### 9.1 PreservaÃ§Ã£o de Rastreabilidade
- Todo agrupamento DEVE referenciar explicitamente os IDs das evidÃªncias fonte
- Todo rÃ³tulo provisÃ³rio DEVE referenciar as evidÃªncias das quais foi derivado
- Toda sinalizaÃ§Ã£o DEVE referenciar as evidÃªncias envolvidas

### 9.2 NÃ£o-Destrutividade
- O A1 NUNCA altera registros em `kb_evidence_excerpts`
- O A1 NUNCA remove evidÃªncias aprovadas
- O A1 NUNCA modifica campos `status`, `reviewed_by`, `reviewed_at`

### 9.3 TransparÃªncia de MÃ©todo
- Todo agrupamento DEVE incluir descriÃ§Ã£o textual da base do agrupamento (`cluster_basis`)
- Todo rÃ³tulo DEVE incluir referÃªncia Ã  fonte textual de onde foi extraÃ­do
- Toda sinalizaÃ§Ã£o DEVE incluir descriÃ§Ã£o factual do conflito/redundÃ¢ncia

### 9.4 IdempotÃªncia
- MÃºltiplas execuÃ§Ãµes do A1 sobre o mesmo conjunto de evidÃªncias aprovadas devem produzir resultados consistentes
- Agrupamentos nÃ£o devem variar aleatoriamente entre execuÃ§Ãµes

## 10. Logs e Auditoria

**Tabela sugerida:** `kb_ingestion_logs` ou `mcp_audit_logs`

**Campos mÃ­nimos:**
- `operation = "A1_clustering"`
- `agent_name = "A1"`
- `agent_version`
- `agent_model = "A1-Î±"`
- `input_approved_excerpts_count`
- `output_clusters_count`
- `output_labels_count`
- `output_conflicts_count`
- `warnings`
- `execution_time_ms`
- `profile_id` (referÃªncia ao perfil de execuÃ§Ã£o)

**Regra contratual:**

Toda execuÃ§Ã£o do A1 DEVE gerar exatamente um registro de auditoria.

ExecuÃ§Ãµes sem log sÃ£o consideradas invÃ¡lidas, mesmo que tenham produzido output.

## 11. Invariantes do Sistema

### 11.1 Invariantes de Integridade
- Todo `evidence_id` referenciado pelo A1 DEVE existir em `kb_evidence_excerpts`
- Todo `evidence_id` processado DEVE ter `status = "approved"`
- Todo `evidence_id` processado DEVE ter `reviewed_by IS NOT NULL`

### 11.2 Invariantes de SeguranÃ§a
- Nenhum dado clÃ­nico final validado Ã© criado
- Nenhuma entidade clÃ­nica canÃ´nica Ã© inferida
- Nenhuma relaÃ§Ã£o causal, terapÃªutica ou diagnÃ³stica Ã© persistida
- Nenhuma normalizaÃ§Ã£o ontolÃ³gica Ã© aplicada

### 11.3 Invariantes de Rastreabilidade
- Todo output do A1 DEVE ser rastreÃ¡vel Ã s evidÃªncias aprovadas de origem
- Todo agrupamento, rÃ³tulo ou sinalizaÃ§Ã£o DEVE incluir referÃªncias explÃ­citas
- Nenhuma informaÃ§Ã£o pode ser introduzida sem origem documentada

## 12. RestriÃ§Ãµes de ImplementaÃ§Ã£o

### 12.1 Tecnologias Permitidas
- Embeddings semÃ¢nticos para agrupamento (ex: sentence-transformers)
- Algoritmos de clustering nÃ£o supervisionado (ex: DBSCAN, hierarchical clustering)
- MÃ©tricas de similaridade textual (ex: cosine similarity, Jaccard)
- DetecÃ§Ã£o de n-gramas e co-ocorrÃªncias

### 12.2 Tecnologias Proibidas
- LLMs generativos para criaÃ§Ã£o de rÃ³tulos (exceto extraÃ§Ã£o literal)
- Ontologias externas para normalizaÃ§Ã£o (ICD, SNOMED, MeSH)
- Tradutores automÃ¡ticos
- Sistemas de raciocÃ­nio clÃ­nico ou diagnÃ³stico

### 12.3 ParÃ¢metros de OperaÃ§Ã£o
- Threshold mÃ­nimo de similaridade para agrupamento: definido por perfil de execuÃ§Ã£o
- Tamanho mÃ¡ximo de cluster: definido por perfil de execuÃ§Ã£o
- Threshold de conflito/redundÃ¢ncia: definido por perfil de execuÃ§Ã£o

## 13. Limite Intencional do A1

O agente A1 possui limites intencionais e intransponÃ­veis, definidos para garantir integridade epistemolÃ³gica da base de conhecimento.

1. O A1 NÃƒO realiza validaÃ§Ã£o cientÃ­fica, clÃ­nica, terapÃªutica ou epistemolÃ³gica
2. O A1 NÃƒO julga correÃ§Ã£o, plausibilidade ou aderÃªncia a padrÃµes clÃ­nicos
3. O A1 NÃƒO cria conhecimento clÃ­nico final
4. O A1 NÃƒO infere relaÃ§Ãµes nÃ£o explicitamente presentes nas evidÃªncias
5. O A1 NÃƒO normaliza ou traduz conceitos clÃ­nicos
6. O papel do A1 Ã© estritamente organizacional e preparatÃ³rio:
   agrupar, rotular provisoriamente e sinalizar, sempre de forma conservadora.
7. Qualquer validaÃ§Ã£o, interpretaÃ§Ã£o final ou curadoria clÃ­nica Ã© responsabilidade exclusiva de humanos ou agentes superiores (A2, A3, etc.).

**Este limite Ã© deliberado.**
**Qualquer expansÃ£o deste escopo constitui violaÃ§Ã£o de contrato.**

## 14. Exemplo Simplificado

### Input (kb_evidence_excerpts, status=approved):

**EvidÃªncia 1:**
```json
{
  "id": "uuid-001",
  "excerpt_text": "A sÃ­ndrome de DeficiÃªncia de Yin do Rim manifesta-se com sudorese noturna e boca seca.",
  "suggested_entity_type": "syndrome",
  "status": "approved",
  "reviewed_by": "uuid-reviewer-1"
}
```

**EvidÃªncia 2:**
```json
{
  "id": "uuid-002",
  "excerpt_text": "DeficiÃªncia de Yin do Rim: sudorese noturna, boca e garganta secas.",
  "suggested_entity_type": "syndrome",
  "status": "approved",
  "reviewed_by": "uuid-reviewer-1"
}
```

### Output (kb_evidence_clusters):

```json
{
  "cluster_id": "uuid-cluster-001",
  "evidence_ids": ["uuid-001", "uuid-002"],
  "cluster_basis": "Similaridade textual alta (>0.85) e menÃ§Ã£o explÃ­cita de 'DeficiÃªncia de Yin do Rim' e 'sudorese noturna'",
  "provisional_label": "DeficiÃªncia de Yin do Rim",
  "confidence_level": 0.87
}
```

### Output (kb_evidence_conflicts):

```json
{
  "conflict_id": "uuid-conflict-001",
  "evidence_id_a": "uuid-001",
  "evidence_id_b": "uuid-002",
  "conflict_type": "redundancy",
  "description": "Ambas evidÃªncias descrevem a mesma sÃ­ndrome e sintomas sobrepostos. PossÃ­vel redundÃ¢ncia, requer revisÃ£o humana."
}
```

## 15. Ponto de AtenÃ§Ã£o CrÃ­tico

Se o A1 produzir saÃ­da como:

> "Este cluster representa a sÃ­ndrome de DeficiÃªncia de Yin do Rim segundo a teoria da MTC, caracterizada por..."

ğŸ‘‰ **Contrato violado.**
**Isso Ã© interpretaÃ§Ã£o clÃ­nica, nÃ£o agrupamento conservador.**

Se o A1 criar um rÃ³tulo normalizado como:

> "Kidney Yin Deficiency (SNOMED: 12345678)"

ğŸ‘‰ **Contrato violado.**
**Isso Ã© normalizaÃ§Ã£o ontolÃ³gica, nÃ£o rÃ³tulo provisÃ³rio neutro.**

Se o A1 inferir uma relaÃ§Ã£o como:

> "A DeficiÃªncia de Yin do Rim causa sudorese noturna"

ğŸ‘‰ **Contrato violado.**
**Isso Ã© inferÃªncia causal, nÃ£o sinalizaÃ§Ã£o de co-ocorrÃªncia.**

## 16. Controle de VersÃ£o e Imutabilidade

**VersÃ£o:** A1 v1.0
**Data de criaÃ§Ã£o:** 2026-01-27
**Status:** Ativo

**DependÃªncias congeladas:**
- A0.md (hash: ab43bca68c1607c3b140bb72a60497d068a8ccd41145f29b00eedcbfbeab852c)
- a0_execution_invariants_v1.md (hash: dd34f985ae3ca215378af9550d702a18fbe846c4d2b1186455e8a824577480da)

**Regra de imutabilidade:**
Qualquer alteraÃ§Ã£o nos artefatos A0 invalida semanticamente este contrato A1 e requer revisÃ£o formal.
